<!-- Don't process empty content files -->
{{- if ne (len .RawContent) 0 -}}
  {{- $rawContent := .RawContent -}}
  {{- $rawContent := replaceRE "\r?\n---\r?\n" "____HORIZONTAL_SEPARATOR____" $rawContent -}}
  {{- $rawContent := replaceRE "\r?\n--\r?\n" "____VERTICAL_SEPARATOR____" $rawContent -}}
  <!-- Save page for reuse below -->
  {{- $page := . -}}
  <!-- Wrap in <section> tag if page params indicates vertical slides -->
  {{- if $page.Params.reveal.vertical -}}
<section>
  {{- end -}}
  <!-- Split the raw content by the horizontal separator -->
  {{- range (split $rawContent "____HORIZONTAL_SEPARATOR____") -}}
    <!-- Wrap in <section> tag if content indicates vertical slides (conflicts with page params) -->
    {{- if (and (in . "____VERTICAL_SEPARATOR____") (not $page.Params.reveal.vertical)) -}}
<section>
    {{- end -}}
    <!-- Split the raw content by the horizontal separator -->
    {{- range (split . "____VERTICAL_SEPARATOR____") -}}
    {{- $content := . | $page.RenderString -}}

    <!-- Remove the <hr /> tag generated by blackfriday for footnotes -->
    {{- $content := replace $content "<div class=\"footnotes\">\n\n<hr />" "<div class=\"footnotes\">" -}}
    <!-- <code> blocks processed by Hugo's highlighter have a data-lang attribute. For those, we disable -->
    <!-- highlight.js by changing the language class to "nohighlight", and adding "data-noescape".       -->
    {{- $content := replaceRE `<code class="language-\w+"\s+data-lang="\w+"` `<code class="nohighlight" data-noescape` $content -}}
    <!-- enable Highlight.js line numbers when the markdown code block language selection is followed by "{}" e.g. ```js{} -->
    {{- $content := replaceRE `(<code class="language-\w+){}(">)` `$1" data-line-numbers>` $content -}}
    <!-- enable Highlight.js line highlights when the language selection is followed by "{<line numbers>}" e.g. ```js{1,5-7} -->
    {{- $content := replaceRE `(<code class="language-\w+){(\S+)}(">)` `$1" data-line-numbers="$2">` $content -}}
    <!-- Support both <hr /> (blackfriday) and <hr> (mmark) -->
    {{- $content := replace $content "<hr>" "<hr />" -}}

  <!-- Split the processed content by <hr /> tag -->
  {{- range (split $content "<hr />") -}}
    <!-- Only wrap in <section> tag if not already wrapped by shortcode -->
    {{- if not (in . "data-noprocess") -}}
<section>
    {{- end -}}
    {{- . | safeHTML -}}
    <!-- Only wrap in <section> tag if not already wrapped by shortcode -->
    {{- if not (in . "data-noprocess") -}}
</section>
    {{- end -}}
  {{- end -}}

    {{- end -}}
    <!-- Wrap in <section> tag if content indicates vertical slides (conflicts with page params) -->
    {{- if (and (in . "____VERTICAL_SEPARATOR____") (not $page.Params.reveal.vertical)) -}}
</section>
    {{- end -}}
  {{- end -}}
  <!-- Wrap in <section> tag if page params indicates vertical slides -->
  {{- if $page.Params.reveal.vertical -}}
</section>
  {{- end -}}
{{- end -}}
